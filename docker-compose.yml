version: "3"
volumes:
  tmpdir:
services:
  canary:
    container_name: autograph-canary
    image: autograph-canary
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - CANARY_LOG_LEVEL=debug
    volumes:
      - tmpdir:/tmp/

  emulator:
    container_name: autograph-canary-lambda-emulator
    image: autograph-canary-lambda-emulator
    build:
      context: .
      dockerfile: Dockerfile.lambda-emulator
    volumes:
      - tmpdir:/tmp/
      # uncomment for local development; leave commented for CI since CircleCI doesn't support volume mounts
      # - ./tests/:/function/tests/
      # - ./:/function/local/
    environment:
      - CANARY_LOG_LEVEL=debug
      # uncomment to run one test
      # - TEST_FILES_GLOB=content_signature_test.js
      # - TEST_FILES_GLOB=addon_signature_test.js
    ports:
      - "9000:8080"

  js-devtools:
    container_name: autograph-canary-js-devtools
    image: autograph-canary-js-devtools
    build:
      context: .
      dockerfile: Dockerfile.js-devtools
    volumes:
      - .:/app
